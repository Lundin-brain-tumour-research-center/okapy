<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Modules" href="modules.html" /><link rel="prev" title="Installation" href="installation.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>Usage - OkaPy 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">OkaPy 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">OkaPy 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">OkaPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Link to this heading">#</a></h1>
<p>OkaPy is designed for processing 3D DICOM images.</p>
<p>There are two primary use cases for OkaPy:</p>
<ol class="arabic simple">
<li><p><strong>Conversion to NIfTI Files:</strong>
OkaPy allows you to convert unsorted DICOM files to NIfTI files, specifically handling 3D images.</p></li>
<li><p><strong>Feature Extraction from DICOM Files:</strong>
Another usage involves extracting features directly from unsorted DICOM files. In this scenario, OkaPy first converts the DICOM files to NIfTI format and then utilizes <a class="reference external" href="https://www.radiomics.io/pyradiomics.html">PyRadiomics</a> to perform feature extraction.</p></li>
</ol>
<p>Example of the first usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">okapy.dicomconverter.converter</span> <span class="kn">import</span> <span class="n">NiftiConverter</span>

<span class="n">path_input</span> <span class="o">=</span> <span class="s2">&quot;path/to/DICOM/folder&quot;</span>
<span class="n">path_output</span> <span class="o">=</span> <span class="s2">&quot;path/to/NIfTI/folder&quot;</span>
<span class="n">converter</span> <span class="o">=</span> <span class="n">NiftiConverter</span><span class="p">()</span>
<span class="n">result_conversion</span> <span class="o">=</span> <span class="n">converter</span><span class="p">(</span><span class="n">path_input</span><span class="p">,</span> <span class="n">output_folder</span><span class="o">=</span><span class="n">output_folder</span><span class="p">)</span>
</pre></div>
</div>
<p>The <cite>result_conversion</cite> is a summary of the conversion. Calling <a class="reference internal" href="modules.html#okapy.dicomconverter.converter.NiftiConverter" title="okapy.dicomconverter.converter.NiftiConverter"><code class="xref py py-class docutils literal notranslate"><span class="pre">okapy.dicomconverter.converter.NiftiConverter</span></code></a> like this will
read all the DICOM files from the <cite>path_input</cite> and convert all the images to NIfTI and store it in the <cite>path_output</cite> folder.
If RTSTRUCT are present, all the labels contained in the RTSTRUCT files will be stored in different NIfTI files (this behaviour can be controlled
with the <cite>labels_startswith</cite> parameter that can be passe to the constructor of <a class="reference internal" href="modules.html#okapy.dicomconverter.converter.NiftiConverter" title="okapy.dicomconverter.converter.NiftiConverter"><code class="xref py py-class docutils literal notranslate"><span class="pre">okapy.dicomconverter.converter.NiftiConverter</span></code></a>).</p>
<p>Example of the second usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">okapy.dicomconverter.converter</span> <span class="kn">import</span> <span class="n">ExtractorConverter</span>

<span class="n">path_input</span> <span class="o">=</span> <span class="s2">&quot;path/to/DICOM/folder&quot;</span>
<span class="n">path_to_params</span> <span class="o">=</span> <span class="s2">&quot;path/to/parameters.yaml&quot;</span>
<span class="n">converter</span> <span class="o">=</span> <span class="n">ExtractorConverter</span><span class="o">.</span><span class="n">from_params</span><span class="p">(</span><span class="n">path_to_params</span><span class="p">)</span>
<span class="n">result_conversion</span> <span class="o">=</span> <span class="n">converter</span><span class="p">(</span><span class="n">path_input</span><span class="p">)</span>
</pre></div>
</div>
<p>The <cite>result_conversion</cite> is <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> containing all the feature values for each images.
To use the converter this way, one must ensure that segmentation are present for each studies in the form of SEG or RTSTRUCT files.
For PET images, one might want to use a RSTRUCT drawn on the CT, this can be achieved with the parameter <code class="code docutils literal notranslate"><span class="pre">combine_segmentation:</span> <span class="pre">True</span></code> in the
parameter file. More details are provided below for the parameter file.</p>
<section id="parameter-file">
<h2>Parameter File<a class="headerlink" href="#parameter-file" title="Link to this heading">#</a></h2>
<p>The parameter file for OkaPy is a YAML file containing configuration settings for various aspects of the processing pipeline. Here is an example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">general</span><span class="p">:</span>
<span class="w">  </span><span class="nt">padding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"> </span><span class="c1"># padding in [mm] around the union of the segmentations to avoid resampling huge image, &quot;whole_image&quot; is a possible value if you want to resample the whole image</span>
<span class="w">  </span><span class="nt">submodalities</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># used for MR, if true okapy parse the SeriesDescription DICOM tag for ` --- ` and append the following string to the modality</span>
<span class="w">  </span><span class="nt">combine_segmentation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># If the segmentation within a study should be used for all modality (can be useful for PT when the RTSTRUCT is drawn on the CT)</span>
<span class="w">  </span><span class="nt">result_format</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;long&quot;</span><span class="w"> </span><span class="c1"># &quot;long&quot; or &quot;multiindex&quot;, &quot;long&quot; should be used</span>
<span class="w">  </span><span class="nt">additional_dicom_tags</span><span class="p">:</span><span class="w"> </span><span class="c1"># Add DICOM tag here, they will be added in the final Dataframe</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;SeriesInstanceUID&quot;</span>

<span class="nt">volume_preprocessing</span><span class="p">:</span><span class="w"> </span><span class="c1"># all the preprocessing applied to the images by modality</span>
<span class="w">  </span><span class="nt">common</span><span class="p">:</span><span class="w"> </span><span class="c1"># to apply to all the images</span>
<span class="w">  </span><span class="nt">PT</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bspline_resampler</span><span class="p">:</span><span class="w"> </span><span class="c1"># name defined when subclassing `okapy.dicomconverter.volume_processor.VolumeProcessor`</span>
<span class="w">      </span><span class="nt">resampling_spacing</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.0</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">CT</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bspline_resampler</span><span class="p">:</span>
<span class="w">      </span><span class="nt">resampling_spacing</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="c1"># to apply if the modality is not defined</span>

<span class="nt">mask_preprocessing</span><span class="p">:</span><span class="w"> </span><span class="c1"># all the preprocessing applied to the segmentation (RTSTRUCT or SEG), the &quot;pixel_spacing&quot; is inferred on the image it corresponds to</span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span>
<span class="w">    </span><span class="nt">binary_bspline_resampler</span><span class="p">:</span>
<span class="w">      </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="nt">feature_extraction</span><span class="p">:</span><span class="w"> </span><span class="c1"># parameters for the feature extraction, can be defined for each modality/submodality</span>
<span class="w">  </span><span class="nt">MR</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pyradiomics</span><span class="p">:</span><span class="w"> </span><span class="c1"># The following are the parameters for pyradiomics, you can paste parameters.yaml from their github with the right indentation</span>
<span class="w">      </span><span class="nt">original</span><span class="p">:</span>
<span class="w">        </span><span class="nt">imageType</span><span class="p">:</span>
<span class="w">          </span><span class="nt">Original</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">        </span><span class="nt">featureClass</span><span class="p">:</span>
<span class="w">          </span><span class="nt">shape</span><span class="p">:</span>
<span class="w">          </span><span class="nt">firstorder</span><span class="p">:</span>

<span class="w">        </span><span class="nt">setting</span><span class="p">:</span>
<span class="w">          </span><span class="nt">normalize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">          </span><span class="nt">normalizeScale</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w">  </span><span class="c1"># This allows you to use more or less the same bin width.</span>
<span class="w">          </span><span class="nt">binWidth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">          </span><span class="nt">voxelArrayShift</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">          </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">common</span><span class="p">:</span><span class="w"> </span><span class="c1"># Feature extraction applied to all modalities</span>
<span class="w">      </span><span class="nt">riesz</span><span class="p">:</span><span class="w"> </span><span class="c1"># Not supported out of the box, a MATLAB image of QuantImage v1 is used for that</span>
<span class="w">        </span><span class="nt">extractor0</span><span class="p">:</span>
<span class="w">          </span><span class="nt">RieszOrder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">          </span><span class="nt">RieszScales</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</pre></div>
</div>
<p>Other examples can be found in <code class="file docutils literal notranslate"><span class="pre">parameters/</span></code>.
The preprocessing applied to the images and segmentations can be tailored to your need. This step is abstracted by the class <code class="xref py py-class docutils literal notranslate"><span class="pre">okapy.dicomconverter.volume_processor.VolumeProcessor</span></code>.
By subclassing this class it is possible to define your own preprocessing step.</p>
</section>
<section id="subclassing-volumeprocessor">
<h2>Subclassing <code class="xref py py-class docutils literal notranslate"><span class="pre">VolumeProcessor</span></code><a class="headerlink" href="#subclassing-volumeprocessor" title="Link to this heading">#</a></h2>
<p>You can create a custom processor by subclassing <code class="xref py py-class docutils literal notranslate"><span class="pre">okapy.dicomconverter.volume_processor.VolumeProcessor</span></code>.
When doing so, it’s essential to specify a <cite>name</cite> parameter for reference in the parameter YAML file. Here’s an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyImageProcessor</span><span class="p">(</span><span class="n">VolumeProcessor</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_image_processor&quot;</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">my_arg1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">my_arg2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_arg1</span> <span class="o">=</span> <span class="n">my_arg1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_arg2</span> <span class="o">=</span> <span class="n">my_arg2</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">mask_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># your processing</span>
        <span class="k">return</span> <span class="n">volume</span>
</pre></div>
</div>
<p>The <cite>MyImageProcessor</cite> example demonstrates subclassing <cite>VolumeProcessor</cite>, specifying initialization arguments through <cite>__init__</cite>, and implementing the processing logic in the <cite>process</cite> method. Ensure to provide the required <cite>name</cite> parameter.</p>
<p>Requirements for the subclass:
- Implement the <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code> method specifying preprocessing arguments.
- Implement the <code class="xref py py-meth docutils literal notranslate"><span class="pre">process()</span></code> method, which receives the image (<cite>volume</cite> variable) and segmentation (<cite>mask_file</cite> variable).</p>
<p>The base class, <code class="xref py py-class docutils literal notranslate"><span class="pre">okapy.dicomconverter.volume_processor.VolumeProcessor</span></code>, provides access to the segmentation resampler through the <cite>mask_resampler</cite> attribute.</p>
</section>
<section id="additional-example-masked-standardizer">
<h2>Additional Example: Masked Standardizer<a class="headerlink" href="#additional-example-masked-standardizer" title="Link to this heading">#</a></h2>
<p>Here’s an additional example illustrating a processor that standardizes an image within a region defined by a specific label:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MaskedStandardizer</span><span class="p">(</span><span class="n">VolumeProcessor</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;masked_standardizer&quot;</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">mask_label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mask_resampler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_label</span> <span class="o">=</span> <span class="n">mask_label</span>
        <span class="k">if</span> <span class="n">mask_resampler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;mask_resampler cannot be None&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_resampler</span> <span class="o">=</span> <span class="n">mask_resampler</span>

    <span class="k">def</span> <span class="nf">_get_mask_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask_files</span><span class="p">,</span> <span class="n">reference_frame</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">mask_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_label</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_volume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_label</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingSegmentationException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The label </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_label</span><span class="si">}</span><span class="s2"> was not found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_resampler</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">new_reference_frame</span><span class="o">=</span><span class="n">reference_frame</span><span class="p">)</span><span class="o">.</span><span class="n">array</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">mask_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">array</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mask_array</span><span class="p">(</span>
            <span class="n">mask_files</span><span class="p">,</span> <span class="n">reference_frame</span><span class="o">=</span><span class="n">volume</span><span class="o">.</span><span class="n">reference_frame</span><span class="p">)</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">mask_array</span><span class="p">])</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">mask_array</span><span class="p">])</span>
        <span class="n">array</span> <span class="o">=</span> <span class="p">(</span><span class="n">array</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
        <span class="n">volume</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
        <span class="k">return</span> <span class="n">volume</span>
</pre></div>
</div>
<p>Now if you want to use the <cite>MaskedStandardizer</cite> in your pipeline, simply write this in your YAML file (under the section preprocesing):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">volume_preprocessing</span><span class="p">:</span>
<span class="w">  </span><span class="nt">MR</span><span class="p">:</span>
<span class="w">    </span><span class="nt">masked_standardizer</span><span class="p">:</span><span class="w"> </span><span class="c1"># the name you defined during suclassing</span>
<span class="w">      </span><span class="nt">mask_label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;edema&quot;</span><span class="w"> </span><span class="c1"># the argument you define, here as an example we took edema</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="modules.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Modules</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="installation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Installation</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019, Valentin Oreiller
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Usage</a><ul>
<li><a class="reference internal" href="#parameter-file">Parameter File</a></li>
<li><a class="reference internal" href="#subclassing-volumeprocessor">Subclassing <code class="xref py py-class docutils literal notranslate"><span class="pre">VolumeProcessor</span></code></a></li>
<li><a class="reference internal" href="#additional-example-masked-standardizer">Additional Example: Masked Standardizer</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>